# Mouse Direction Sync (Wayland)

Графічний додаток для Wayland, що утримує клавіші **A** або **D** відповідно до напрямку руху миші чи тачпада. Інструмент читає

події пристроїв через `libinput` та емулює натискання клавіш за допомогою `uinput`. Ви можете прив'язати власну клавішу активації,

налаштувати ступінь рандомізації синхронізації та перемикати світлу/темну тему.

## Можливості

- Відстеження горизонтального руху в Wayland через `libinput` без залежності від X11.
- Автоматичне натискання `A` при русі вліво та `D` при русі вправо (через віртуальну клавіатуру `uinput`).
- Клавіша активації з довільним вибором: поки клавішу затиснуто — працює емулювання, після відпускання — миттєвий стоп.
- Режим рандомізації з настроюваним діапазоном синхронізації (наприклад 70–90 %).
- Охайний інтерфейс Qt із перемикачем світлої/темної теми.
- Автовизначення активних пристроїв (миша/тачпад та клавіатура) із фільтрами брендів.
- Автозбереження налаштувань у `~/.config/Mouse→A_D Helper.ini`.
- Автоматичне вікно підтвердження доступу через `pkexec + setfacl`, щоб обійтися без ручних udev-груп.

## Повний гайд з підготовки середовища (Arch Linux)

1. **Встановіть пакунки для збірки і роботи:**
   ```bash
   sudo pacman -S --needed qt6-base cmake ninja gcc pkgconf libinput seatd polkit acl
   ```

2. **Увімкніть `seatd`, щоб надавати доступ до пристроїв введення без root:**
   ```bash
   sudo systemctl enable --now seatd.service
   ```

3. **Надайте доступ до пристроїв введення (оберіть варіант):**
   - *Автоматичний (рекомендовано).* Просто запускайте програму від свого користувача. Якщо прав бракує, відобразиться діалог «Надати доступ», який через `pkexec` та `setfacl` тимчасово додасть ACL для потрібних `event`-файлів та `/dev/uinput`.
   - *Ручний (постійні групи).* Якщо хочете уникнути діалогів, додайте себе до груп і налаштуйте udev:
     ```bash
     sudo groupadd -r uinput 2>/dev/null || true
     sudo gpasswd -a "$USER" input
     sudo gpasswd -a "$USER" uinput
     sudo tee /etc/udev/rules.d/99-input-perms.rules >/dev/null <<'RULES'
     KERNEL=="event*", GROUP="input", MODE="0660"
     KERNEL=="uinput", GROUP="uinput", MODE="0660"
     RULES
     sudo udevadm control --reload
     sudo udevadm trigger --subsystem-match=input
     ```
     Після цього вийдіть із сеансу та зайдіть знову, щоб оновилися групи користувача.

4. **Клонуйте репозиторій та зберіть проєкт:**
   ```bash
   git clone https://github.com/<your-account>/mouse-direction-sync.git
   cd mouse-direction-sync
   cmake -S . -B build -G Ninja
   cmake --build build
   ```

5. **Запускайте програму у Wayland-сеансі через `seatd-launch` (рекомендовано):**
   ```bash
   seatd-launch -- ./build/mouse_direction_binder
   ```
   Якщо `seatd` недоступний, можна запустити від `root`, але це менш безпечно:
   ```bash
   sudo QT_QPA_PLATFORM=wayland ./build/mouse_direction_binder
   ```

   При автоматичному режимі доступу перший запуск покаже діалог «Надати доступ». Після підтвердження `pkexec` виконає `setfacl`, щоб надати поточному користувачу права читання/запису до відповідних пристроїв.

> **Примітка:** Програма працює лише у Wayland-сеансах. Для коректного рендеру Qt переконайтеся, що змінна `QT_QPA_PLATFORM` встановлена

> в `wayland` (Qt робить це автоматично у більшості сучасних середовищ KDE/GNOME).

## Використання

1. Запустіть додаток.
2. Виберіть зручну клавішу активації (попередньо вона — `Left Shift`).
3. За потреби увімкніть рандомізацію синхронізації та відрегулюйте мінімальний/максимальний відсоток.
4. Утримуйте клавішу активації, рухаючи мишею: ліворуч — утримується `A`, праворуч — `D`.
5. Відпустіть клавішу, щоб миттєво припинити емулювання.
6. Перевірте розділ «Автовизначені пристрої» — там мають з'явитися ваша миша/тачпад та клавіатура. За потреби скоригуйте фільтри брендів у конфігурації.

## Конфігураційний файл

Після першого запуску створюється `~/.config/Mouse→A_D Helper.ini`. У ньому зберігаються:

- обрана клавіша активації та тема оформлення;
- стан рандомізатора й діапазон синхронізації;
- списки дозволених/заборонених брендів (`Devices/PointerAllow`, `Devices/PointerBlock`, `Devices/KeyboardAllow`, `Devices/KeyboardBlock`).

Назви брендів розділяйте комами або крапками з комою. Значення порівнюються без урахування регістру, тож можна додавати власні комбінації для улюбленої периферії чи блокувати віртуальні пристрої.

## Усунення несправностей

 - **Немає доступу до пристроїв введення:** переконайтеся, що `seatd` запущений, та повторно підтвердьте діалог «Надати доступ». Якщо використовуєте ручний режим — перевірте членство в групах `input`/`uinput` та коректність правил udev.
- **`seatd-launch` не знайдено:** переконайтеся, що пакет `seatd` встановлено; двійковий файл може називатися `seatd-launch` або `seatd` залежно від пакування.
- **Qt запускається у XWayland:** задайте `QT_QPA_PLATFORM=wayland` перед запуском.


